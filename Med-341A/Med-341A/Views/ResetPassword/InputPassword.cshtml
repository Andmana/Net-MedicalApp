<div class="card">
    <div class="card-body">

        <h2 class="mt-3 text-center">Set Password</h2>
        <p class="text-center">Masukan password baru untuk akun anda</p>

        <form class="mt-4" id="form_setPassword">
            <div class="col-lg-12">
                <div class="form-group">
                    <label class="text-dark" for="Password">Password</label>
                    <input class="form-control" id="Password" type="password" placeholder="Masukan password baru"
                           name="Password">
                    <span class="text-danger" id="validate_password"></span>
                    <span class="text-danger" id="verify_password"></span>
                </div>
            </div>

            <div class="col-lg-12">
                <div class="form-group">
                    <label class="text-dark" for="ConfirmPassword">Masukan Ulang Password</label>
                    <input class="form-control" id="ConfirmPassword" type="password"
                           placeholder="Masukan ulang password" name="ConfirmPassword">
                    <span class="text-danger" id="validate_confirm_password"></span>
                </div>
            </div>

            <div class="col-lg-12 text-center mt-2">
                <button type="submit" class="btn btn-block btn-dark">Set Kata Sandi</button>
            </div>
        </form>
    </div>
</div>

<script>

    function buttonOnLoading(idButton, text) {
        $(idButton).html(
            `<span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                     <span role="status"> ${text} </span>`
        ).prop('disabled', true);
    }

    function buttonOnFinish(idButton, text) {
        $(idButton).html(text).prop('disabled', false);
    }

    $.validator.addMethod("passwordFormatCheck", function (value, element) {
        return this.optional(element) || /^(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*\W).*$/i.test(value);
    }, 'Password must contain capital letter, numeric and special character');

    $("#form_setPassword").validate({
        errorClass: "is-invalid text-danger",
        rules: {
            Password: {
                required: true,
                passwordFormatCheck: true,
                minlength: 8,
            },
            ConfirmPassword: {
                equalTo: "#Password",
            }
        },
        messages: {
            Password: {
                required: "Password is required.",
                password: "Password must contain capital letter, numeric and special character",
                minlength: "Password must be at least 8 characters long."
            },
            ConfirmPassword: {
                equalTo: "Passwords do not match."
            }
        },
        submitHandler: function (form) {
            buttonOnLoading("#btn_submit", "Menyimpan data...");
            var dataForm = $(form).serialize()

            $.ajax({
                url: "ResetPassword/SavePassword",
                type: "post",
                data: dataForm,
                dataType: "json",
                success: function (response) {
                    var data = response.dataResponse
                    if (data.success) {
                        $("#my_modal").modal("hide")
                        swal({
                            title: "Success!",
                            text: data.message,
                            buttons: {
                                confirm: {
                                    className: "btn btn-success",
                                },
                            },
                        }).then((value) => {
                            // This callback runs when the user clicks the confirm button
                            openLoginModal()
                        });

                    } else {
                        $("#verify_password").text(data.message)
                        buttonOnFinish("#btn_submit", "Set Kata Sandi")
                        return true
                    }

                }, function(xhr, status, error) {
                    console.error("Error status:", status);
                    console.error("Error message:", error);
                    console.log("Response:", xhr.responseText);
                }


            })
        },
    })


    
</script>